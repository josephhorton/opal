{% extends "layouts/main.html" %}

{% set pageName = "Add an offence" %}

{% block pageTitle %}
{{ pageName }} – {{ serviceName }} – GOV.UK Prototype Kit
{% endblock %}

{% block beforeContent %}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">{{ pageName }}</h1>
    <h2 class="govuk-heading-m">Impositions</h2>
  </div>
</div>

<form id="employer-details-form" method="post" novalidate action="test-check-offence">

<div class="impositionWrapper govuk-!-margin-bottom-6">
  <div class="govuk-grid-row govuk-!-margin-left-0 govuk-!-margin-right-0 imposition">
    <div class="govuk-grid-column-one-half">
      <div class="govuk-form-group govuk-!-margin-bottom-4">
          <label class="govuk-label govuk-label--s" for="impositionResultCode-1">
            Result code
          </label>
        <select class="govuk-select" id="impositionResultCode-1" name="impositionResultCode-1" style="width: 100%;">
          <option value="" selected disabled>Select result code</option>
          <option value="Compensation (FCOMP)">Compensation (FCOMP)</option>
          <option value="Victim surcharge (FVS)">Victim surcharge (FVS)</option>
          <option value="Costs (FCOST)">Costs (FCOST)</option>
          <option value="Crown prosecution costs (FCPC)">Crown prosecution costs (FCPC)</option>
          <option value="Fine only (FO)">Fine only (FO)</option>
          <option value="Criminal courts charge (FCC)">Criminal courts charge (FCC)</option>
          <option value="FVVehicle excise duty (FVEBD)EBD">Vehicle excise duty (FVEBD)</option>
          <option value="Forfeited recognizance (FFR)">Forfeited recognizance (FFR)</option>
        </select>
      </div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      {{ govukInput({
        id: 'impositionImposed-1',
        name: 'impositionImposed-1',
        value: data['impositionImposed-1'],
        formGroup: {
          classes: "govuk-!-margin-bottom-4"
        },
        label: {
          html: 'Amount imposed',
          classes: 'govuk-!-font-weight-bold'
        },
        prefix: {
          text: "£"
        }
      }) }}
    </div>
    <div class="govuk-grid-column-one-quarter">
      {{ govukInput({
        id: 'impositionPaid-1',
        name: 'impositionPaid-1',
        value: data['impositionPaid-1'],
        formGroup: {
          classes: "govuk-!-margin-bottom-4"
        },
        label: {
          html: 'Amount paid',
          classes: 'govuk-!-font-weight-bold'
        },
        prefix: {
          text: "£"
        }
      }) }}
    </div>
  </div>
  <div class="govuk-grid-row govuk-!-margin-left-0 govuk-!-margin-right-0 creditors" id="add-creditor-section-1" style="display: none;">
    <div class="govuk-grid-column-full">
      <div id="minor-creditor-details" style="display: none;">
        <div class="govuk-summary-card">
          <div class="govuk-summary-card__title-wrapper">
            <dl class="govuk-summary-list govuk-!-margin-bottom-0" >
              <div class="govuk-summary-list__row" style="border: none;">
                <dt class="govuk-summary-list__key">
                  Minor creditor
                </dt>
                <dd class="govuk-summary-list__value">
                  Terrence Lovejoy
                </dd>
                <dd class="govuk-summary-list__actions" style="width: 40%;">
                  <ul class="govuk-summary-list__actions-list">
                    <li class="govuk-summary-list__actions-list-item" data-module="edge">
                      <a class="govuk-link govuk-link--no-visited-state" href="#" data-message="This has not been prototyped. It would show a summary of the details you entered for this minor creditor"><strong>Show details</strong><span class="govuk-visually-hidden"></span></a>
                    </li>
                    <li class="govuk-summary-list__actions-list-item">
                      <a class="govuk-link govuk-link--no-visited-state" href="./test-minor-creditor.html"><strong>Change</strong><span class="govuk-visually-hidden"> minor creditor</span></a>
                    </li>
                    <li class="govuk-summary-list__actions-list-item">
                      <a class="govuk-link govuk-link--no-visited-state" href="#"><strong>Remove</strong><span class="govuk-visually-hidden"> minor creditor</span></a>
                    </li>
                  </ul>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
      <div id="add-creditor-form">
        {% set majorCreditor1HTML %}

        {{ xGovukAutocomplete({
          formGroup: {
            classes: "govuk-input--width-30"
          },
          id: "majorCreditor1",
          name: "majorCreditor1",
          value: data['majorCreditor1'],
          allowEmpty: false,
          displayMenu: "overlay",
          label: {
            classes: "govuk-label--s",
            text: "Search using name or code"
          },  
          items: [
          { text: "Abellio Greater Anglia Ltd (AGAL)" },
          { text: "Aldi (ALDI)" },
          { text: "Anglia Trains (ANGL)" },
          { text: "Asda (ASDA)" },
          { text: "Bedford Borough Council (BEDB)" },
          { text: "B & Q Stores (BNQL)" },
          { text: "Boots (BOOT)" },
          { text: "British Transport Police (BTPO)" },
          { text: "Cambridge City Council (CAMC)" },
          { text: "Charles & Ashby Revenue Ltd (CARV)" },
          { text: "Cambs County Council Education (CBC1)" },
          { text: "Cambridgeshire County Council. (CBCC)" },
          { text: "Central Trains (CENT)" },
          { text: "City of London Police (COLP)" },
          { text: "Co-Operative Group (COP2)" },
          { text: "Crown Prosecution Service (CPS)" },
          { text: "DVLA (DVL2)" },
          { text: "DVSA (DVSA)" },
          { text: "DWP DM (DWP1)" },
          { text: "East Cambs. District Council (ECDC)" },
          { text: "Abellio East Midlands Ltd (EMT1)" },
          { text: "Fenland District Council (FDC)" },
          { text: "Govia Thameslink Railway Ltd (GTLR)" },
          { text: "HMCTS (HMCS)" },
          { text: "HM Revenue and Customs (HMRC)" },
          { text: "Huntingdon District Council (HUDC)" },
          { text: "Iceland Stores (ICE1)" },
          { text: "Insolvency Service (INSS)" },
          { text: "John Lewis Stores (JLEW)" },
          { text: "Lidl Stores (LIDL)" },
          { text: "London North Eastern Railway (LNER)" },
          { text: "Merseyrail Electrics 2002 Ltd (METV)" },
          { text: "Morrisons (MORR)" },
          { text: "Marks and Spencer (MSP)" },
          { text: "Next (NEXT)" },
          { text: "NOMS (NOMS)" },
          { text: "Environment Agency (NRA1)" },
          { text: "Peterborough City Council (PCTC)" },
          { text: "Poundland (PLD)" },
          { text: "Metropolitan Police (PO01)" },
          { text: "PCC for Merseyside (PO05)" },
          { text: "PCC for North Yorkshire (PO12)" },
          { text: "PCC for West Midlands (PO20)" },
          { text: "PCC for Staffordshire (PO21)" },
          { text: "PCC for Derbyshire (PO30)" },
          { text: "PCC for Lincolnshire (PO32)" },
          { text: "PCC for Leicestershire (PO33)" },
          { text: "PCC for Northamptonshire (PO34)" },
          { text: "PCC for Cambridgeshire (PO35)" },
          { text: "PCC for Norfolk (PO36)" },
          { text: "PCC for Suffolk (PO37)" },
          { text: "PCC for Bedfordshire (PO40)" },
          { text: "PCC for Hertfordshire (PO41)" },
          { text: "PCC for Essex (PO42)" },
          { text: "PCC for Thames Valley (PO43)" },
          { text: "PCC for Hampshire (PO44)" },
          { text: "PCC for Surrey (PO45)" },
          { text: "PCC for Kent (PO46)" },
          { text: "Sussex Police (PO47)" },
          { text: "PCC for Avon & Somerset (PO52)" },
          { text: "PCC for Wiltshire (PO54)" },
          { text: "PCC for North Wales (PO60)" },
          { text: "PCC for South Wales (PO62)" },
          { text: "PCC for Dyfed Powys (PO63)" },
          { text: "RSPCA (RSPC)" },
          { text: "Sainsbury's (SAIN)" },
          { text: "South Cambridge D C (SCDC)" },
          { text: "Superdrug (SDRG)" },
          { text: "Tesco (TESC)" },
          { text: "Transport for London (TFL2)" },
          { text: "TK Maxx (TKMX)" },
          { text: "Transport Investigations Ltd (TRAN)" },
          { text: "Capital Business Services Ltd (TVL3)" },
          { text: "National Express Trains LTD (WAGN)" },
          { text: "Wilkinson Stores (WILK)" },
          { text: "Waitrose (WTRO)" }
          ]
        }) }}

        {% endset -%}

        {% set minorCreditor1HTML %}
          <p class="govuk-body"><a href="./test-minor-creditor.html" class="govuk-link govuk-link--no-visited-state">Add minor creditor details</a></p>
        {% endset -%}

        {{ govukRadios({
          formGroup: {
            classes: "govuk-!-margin-bottom-4"
          },
          name: "add-creditor-1",
          data: value['add-creditor-1'],
          id: "add-creditor-1",
          fieldset: {
            legend: {
              text: "Add creditor",
              classes: "govuk-fieldset__legend--s"
            }
          },
          items: [
            {
              value: "Major creditor",
              text: "Major creditor",
              conditional: {
                html: majorCreditor1HTML
              }
            },
            {
              value: "Minor creditor",
              text: "Minor creditor",
              conditional: {
                html: minorCreditor1HTML
              }
            }
          ]
        }) }}
      </div>
    </div>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="moj-button-action">
      {{ govukButton({
        text: 'Add another imposition',
        classes: 'govuk-button--secondary govuk-!-margin-bottom-1'
      }) }}
    </div>
    {# Size modifiers: xl, l, m #}

    <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

    <div class="govuk-button-group">
      <button type="submit" class="govuk-button">
        Review offence
      </button>
      <button type="submit" class="govuk-button govuk-button--secondary" formaction="#">
        Add another offence
      </button>
    </div>

  </div>
</div>

</form>

<p class="govuk-body"><a class="govuk-link govuk-! govuk-link--no-visited-state" href="account-details.html">Cancel</a></p>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const resultCodeInput = document.getElementById('impositionResultCode-1');
    const imposedInput = document.getElementById('impositionImposed-1');
    const paidInput = document.getElementById('impositionPaid-1');
    const addCreditorSection = document.getElementById('add-creditor-section-1');
    const minorCreditorDetails = document.getElementById('minor-creditor-details');
    const addCreditorForm = document.getElementById('add-creditor-form');

    // Function to check the selected result code and show/hide the add-creditor section
    function checkResultCode() {
        const selectedOption = resultCodeInput.value.trim();
        if (selectedOption === 'Costs (FCOST)' || selectedOption === 'Compensation (FCOMP)') {
            addCreditorSection.style.display = 'block';
        } else {
            addCreditorSection.style.display = 'none';
        }
    }

    // Save data to localStorage
    function saveData() {
        localStorage.setItem('impositionResultCode', resultCodeInput.value);
        localStorage.setItem('impositionImposed', imposedInput.value);
        localStorage.setItem('impositionPaid', paidInput.value);
    }

    // Load data from localStorage
    function loadData() {
        if (localStorage.getItem('impositionResultCode')) {
            resultCodeInput.value = localStorage.getItem('impositionResultCode');
        }
        if (localStorage.getItem('impositionImposed')) {
            imposedInput.value = localStorage.getItem('impositionImposed');
        }
        if (localStorage.getItem('impositionPaid')) {
            paidInput.value = localStorage.getItem('impositionPaid');
        }
        checkResultCode();
        if (localStorage.getItem('minorCreditor1Added') === 'true') {
            minorCreditorDetails.style.display = 'block';
            addCreditorForm.style.display = 'none';
        } else {
            minorCreditorDetails.style.display = 'none';
            addCreditorForm.style.display = 'block';
        }
    }

    // Add event listeners
    resultCodeInput.addEventListener('change', function() {
        checkResultCode();
        saveData();
        localStorage.removeItem('minorCreditor1Added'); // Reset the minor creditor flag
    });
    imposedInput.addEventListener('input', saveData);
    paidInput.addEventListener('input', saveData);

    // Initial load
    loadData();
});

</script>

{% endblock %}
